@{ 
    var redirectUrl = Server.UrlDecode(Request.Params["RedirectUrl"]); 
}

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <script src="~/Areas/Mobile/scripts/jquery-1.10.2.js"></script>  
    <link href="~/Areas/Mobile/Style/font-awesome.min.css" rel="stylesheet" />
    <link href="~/Areas/Mobile/Style/login.css" rel="stylesheet" />
</head>
 
<style>
    body,html {
        overflow: hidden;
        height:100%;  
        font-size:16px;
        background:#efefef
    } 
     
       .GetYZM {
       position:absolute; 
       border-radius:10px;
       width:120px!important;
       padding:0!important;
       line-height:45px; 
       background:none;
       border:none;
       z-index:99;  
       right:0px;
    }

     
</style>

<div class="header" style="height:20%;">
    <div style="height:70px;text-align:center;font-size:20px;">
        <img src="~/Areas/Mobile/Images/logo.png" />
        &emsp;考勤打卡系统（移动端）
    </div>
</div> 

<div style="height:20%;margin-bottom:10px;">
    <img src="~/Areas/Mobile/Images/banner.jpg" style="height:100%;width:100%;" />
</div>
 

<fieldset class="mainInfo" style="height:50%;">
    <legend style="font-size:20px;">用户登录信息</legend>
    <form>
        <div style="text-align:center;width:100%;">
            <div class="textbox">
                <i class="fa fa-user fa-2x YZM" style="text-align:center;position:absolute;width:55px;line-height:50px;"></i>
                <input type="text" id="username" placeholder="输入账号" name="username" /> 
            </div>
         
            <div class="textbox">
                <i class="fa fa-key fa-2x YZM" style="text-align:center;position:absolute;width:55px;line-height:50px;"></i>
                <input type="password" id="password" placeholder="输入密码" name="password" />
            </div>
            <div class="textbox">
                <i class="fa fa-mobile fa-2x YZM" style="text-align:center;position:absolute;width:55px;line-height:50px;"></i>
                <input type="text" id="Code" placeholder="输入验证码" name="Code" />
                <input type="button" class="GetYZM"  value="获取验证码"  onclick="GetYZM()" />
            </div>
        </div>
    </form>
    <div class="btn-line" style="margin-top:10px;">
        <input type="button" id="btn-login"  value="登　录"  style="color:white;background:#61afea" onclick="Login()"/>
        <input type="button" id="btn-cancel" value="重　置"  style="color:white;background:#61afea" />
    </div>
</fieldset>
 
@*<div id="footer" style="width:100%;height:80px;">
        <div id="row2">
            中国·浙江·宁波吉大信息科技有限公司 <br/> 版权所有 浙ICP备14031355号-1
        </div>
    </div>*@
<script>


    $(".header").css({
        "padding-top":($(window).height()*0.2 - 70)/2
    })

    $(function ()
    {
        //$("#footer").css({
        //    "margin-top":$(document).height() * 0.31 - 180
        //})
         
        
    })


    function Login()
    {
        if ($("#Code").val() == "") {
            alert("请输入验证码");
            return;
        }
        if ($("#Code").val() == sessionStorage.getItem("LoginCode")) {
            $.ajax({
                url: "@Url.Action("UserLogin")",
                type: "post",
                data: $("form").serialize(),
                success: function (data) {
                    if (!data.Success) {
                        alert(data.Message)
                    } else {
                        if ('@redirectUrl') {
                            location.href = "@redirectUrl";
                        }
                        else {
                            location.href = "@Url.Action("Index","Home")";
                        }
                    }
                }
            })
        }
        else {
            alert("验证码错误！")
        }
    }

      
    $("#btn-cancel").click(function () {
        $("#username").val("");
        $("#password").val(""); 
        $("#YZM").val("");
    })


    function GetYZM()
    {

        if ($("#username").val() == "") {
            alert("用户名不能为空");
            $("#username").focus();
            return;
        }
        if ($("#password").val() == "") {
            alert("密码不能为空");
            $("#password").focus();
            return;
        }

        $.ajax({
            url: "@Url.Action("SendCode")",
            type: "post",
            data: $("form").serialize(),
            async: false,
            success: function (data) {
                if (data.Success)
                {
                    sessionStorage.clear("LoginCode");
                    sessionStorage.setItem("LoginCode", data.Message); 
                    CodeTimer();
                }
                else {
                    alert(data.Message);
                }
            }
        }) 
    }


    function CodeTimer()
    {
        $(".GetYZM").attr("disabled","true");
        $(".GetYZM").val("60秒后重新获取");
        time = 60;
        var timer =  setInterval(function () {
            time = --time ;
            $(".GetYZM").val("" + time + "秒后重新获取");
            if (time == 0) {
                clearInterval(timer);
                $(".GetYZM").val("获取验证码");
                $(".GetYZM").removeAttr("disabled");
            }
        }, 1000)
    }


    //调用服务器端的Action
    function callAction(url, data, callback) {
        var type = "post";
        if (!data) {
            type = "get";
            data = {};
        }
        $.ajax({
            url: url,
            type: type,
            dataType: "json",
            data: data,
            success: function (data) {
                if (!callback || callback(data)) {
                    if (!data.Success) {
                        $.messager.alert(data.Title || "错误", data.Message, "error")
                    } else {
                        $.messager.alert("操作成功", "操作成功");
                    }
                }
            },
            error: function () {
                $.messager.alert("操作失败", "系统错误", "error")
            }
        })
    }

</script>